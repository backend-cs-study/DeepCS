# 2.4 IP 주소

## 2.4.1 ARP


: IP 주소로부터 MAC 주소를 구하는 IP와 MAC 주소의 다리 역할을 하는 프로토콜


> `ARP` : 가상주소 (IP) -> 실제주소 (MAC) 변환
> 
> `RARP` : 실제주소 (MAC) -> 가상주소 (IP) 변환
> 
> 가상 주소=논리적 주소, 실제 주소=물리적 주소
> 

###  ARP가 주소를 찾는 과정
1. `장치 A` : **ARP Request 브로드캐스트**를 보냄
2. IP주소에 해당하는 특정 MAC 주소를 찾음
3. 해당 주소와 일치하는 `장치 B` : **ARP Reply 유니캐스트**를 통해 MAC 주소를 반환


> `브로드캐스트` : 송신 호스트가 전송한 데이터가 **네트워크에 연결된 모든 호스트에 전송**되는 방식 
> 
> `유니캐스트` : 고유 주소로 식별된 하나의 네트워크 목적지에 1:1로 데이터를 전송하는 방식
>

[참고 블로그1](https://aws-hyoh.tistory.com/70)

[참고 블로그2](https://kujung.tistory.com/entry/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-ARP-%EA%B0%9C%EB%85%90-%EB%B0%8F-%EB%8F%99%EC%9E%91%EB%B0%A9%EC%8B%9D)

***

## 2.4.2 홉바이홉 통신


: IP주소를 통해 통신하는 과정

> 홉(hop) = 한 발로 깡충깡충 뛰다
> 
> -> 통신망에서 각 패킷이 여러 개의 라우터를 건너가는 모습을 비유한 것

* 수많은 서브 네트워크 속에서 라우터에 있는 라우팅 테이블의 IP를 기반으로 패킷을 전달하고, 또 전달해나가며 라우팅을 수행하며 최종 목적지까지 패킷을 전달함
* 즉, 통신 장치에 있는 `라우팅 테이블`의 IP를 통해 시작 주소부터 다음 IP로 계속해서 이동하는 라우팅 과정을 거쳐서 패킷이 최종 목적지까지 도달하는 통신

> 라우팅(routing) : IP주소를 찾아가는 과정

![홉바이홉 통신](https://velog.velcdn.com/images/jiyaho/post/dfaabd97-b501-465e-857d-0a021cd8347b/image.png)

### `라우팅 테이블`


: 송신지에서 수신지까지 도달하기 위해 사용, 

* 라우터에 들어가 있는 목적지 정보들과 그 목적지로 가기 위한 방법이 들어있는 리스트 
* 게이트웨이와 모든 목적지에 대해 해당 목적지에 도달하기 위해 거쳐야 할 다음 라우터의 정보를 가지고 있음

> ### `게이트웨이`
> 
> : 서로 다른 통신망, 프로토콜을 사용하는 네트워크 간의 통신을 가능하게 하는 컴퓨터나 소프트웨어
> * 사용자는 인터넷에 접속하기 위해 수많은 게이트웨이를 거침
> * 게이트웨이는 서로 다른 네트워크상의 통신 프로토콜을 변환해줌
> 
> <게이트웨이 확인하는 방법>
> * 윈도우 `$netstat -r` / 리눅스 `$netstat -rn`명령어를 실행하여 라우팅 테이블을 통해 확인
> 
> [참고 블로그 : Linux - 라우팅 테이블 구조와 route 명령어](https://samso.tistory.com/entry/Linux-route-%EB%AA%85%EB%A0%B9%EC%96%B4-%EC%82%AC%EC%9A%A9%EB%B2%95)
>
> 
> ![image](https://github.com/user-attachments/assets/1116a254-4e0e-4c3f-9251-b83bf7224c03)
> 
> 
> IPv4와 IPv6에 대한 경로 테이블 = 라우팅 테이블 / 해당 테이블들 내에 게이트웨이 및 인터페이스 등을 확인할 수 있다.

***
## 2.4.3. IP 주소 체계


### IPv4와 IPv6

* `IPv4` : 32비트를 8비트 단위로 점을 찍어 표기 (123.45.67.89)
* `IPv6` : 64비트를 16비트 단위로 점을 찍어 표기 (2001:db8::ff00:42:8329)

### 클래스 기반 할당 방식


: A, B, C, D, E 이렇게 다섯 개의 클래스로 구분하는 할당 방식 <br>
앞의 부분을 네트워크 주소, 그 뒤를 컴퓨터에 부여하는 호스트 주소로 사용

* 클래스 A, B, C : 일대일 통신으로 사용
* 클래스 D : 멀티캐스트 통신
* 클래스 E : 앞으로 사용할 예비용

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99068D495BE8101D34)

각 클래스별 IP 주소의 구분<br>
* 각 클래스 IP 주소의 범위는 첫 번째 옥텟(octet)의 구분비트를 보면 구별이 가능함
* 각 클래스 별 구분비트 : 클래스 A는 0, 클래스 B는 10, 클래스 C는 110<br>
cf. 옥텟(octet): 8개의 비트가 한데 모인 것<br>
cf. 구분비트: 맨 왼쪽에 있는 비트

| 구분       | 2진수 시작은? (s 네트워크, h 호스트)                                                          | 네트워크 시작번호 (개수)	                         | 호스트 범위 (개수)                         |
|----------|-----------------------------------------------------------------------------------|-----------------------------------------|-------------------------------------|
| **A클래스** | 0sss ssss. hhhh hhhh. hhhh hhhh. hhhh hhhh<br>(0 시작, 네트워크 : 7bit, 호스트 : 24bit)    | 1 ~ 126 시작 <br>(2^7 -1 개 : 127은 제외라 -1) | 2^24 -2 <br>(-2 네트워크, 브로드캐스트 주소 제외) |
| **B클래스** | 	10ss ssss .ssss ssss. hhhh hhhh. hhhh hhhh<br>(10 시작, 네트워크 : 14bit, 호스트 : 16bit) | 128.0 ~ 191.255 시작<br>(2^14 개)          | 2^16 -2 <br>(-2 네트워크, 브로드캐스트 주소 제외) |
| **C클래스** | 110s ssss. ssss ssss. ssss ssss. hhhh hhhh<br>(110 시작, 네트워크 : 21bit, 호스트 : 8bit)  | 192.0.0 ~ 223.255.255 시작<br>(2^22 개)    | 2^8 -2 <br>(-2 네트워크, 브로드캐스트 주소 제외)  |

##### 출처 : https://limkydev.tistory.com/168

* 네트워크 범위가 커질수록 호스트 주소는 작아짐 (반비례)


* 네트워크의 첫번째 주소 : `네트워크 주소`
* 네트워크의 마지막 주소 : `브로드캐스트용 주소` -> 네트워크에 속해 있는 모든 컴퓨터에 데이터 보낼 때 사용
* 첫번째와 마지막 사이의 `나머지 주소들을 호스트 주소로 사용`

=> but, 클래스 기반 할당 방식은 <ins>사용하는 주소보다 버리는 주소가 많아지는 단점</ins>이 있음<br>
이를 해결하기 위한 두 가지 방법 : `DHCP`, `NAT`

### DHCP (Dynamic Host Configuration Protocol)


동적 호스트 구성 프로토콜 
: IP 주소 및 기타 통신 매개변수를 자동으로 할당하기 위한 네트워크 관리 프로토콜 <br>
-> 네트워크 장치의 IP주소를 수동설정X, 인터넷에 접속할 때마다 **자동으로 IP 주소를 할당**

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F2160C93D571C6CBC23)
* 많은 라우터와 게이트웨이 장비에 DHCP 기능 존재. -> 대부분의 가정용 네트워크에서 IP주소를 할당

### NAT (Network Address Translation)

네트워크 주소 변환
: 패킷이 라우팅 장치를 통해 전송되는 동안, 패킷의 IP주소 정보를 수정하여 IP주소를 다른 주소로 매핑하는 방법<br>
-> 사설IP와 공인IP를 양방향적으로 변환


* IPv4 주소 체계만으로는 많은 주소들을 모두 감당하지 못하는 단점이 있는데, 이를 해결하기 위해 NAT으로 공인 IP와 사설 IP로 나눠서 많은 주소를 처리함
* NAT을 가능하게 하는 소프트웨어는 **ICS, RRAS, Netfilter** 등이 있다.

![](https://velog.velcdn.com/images/jiyaho/post/4a813cb0-48e5-480a-8e10-0644f9279f4e/image.svg)

*  각 PC마다 내부적으로 `사설(private) IP`인 <ins>192.168.0.X</ins> 구조로 각자의 IP를 소유<br>
        -> NAT 장치를 통해 하나의 `공인(public)IP`인 <ins>150.65.0.1</ins> 으로 외부 인터넷에 요청 <br>
        => 하나의 공인 IP를 통해 각각의 다른 IP를 가지는 것처럼 사용 가능


#### ● NAT을 사용하는 이유


: 여러 대의 호스트가 하나의 공인 IP 주소를 사용하여 인터넷에 접속하기 위함 <br>
ex. 인터넷 회선 하나를 개통하고 인터넷 공유기를 달아서 여러 PC 연결하여 사용할 때

#### ● NAT를 이용한 보안


: 내부 네트워크에서 사용하는 IP주소와 외부에 드러나느 IP 주소를 다르게 유지<br> -> 내부 네트워크에 대한 어느정도의 보안 가능


#### ● NAT의 단점


: 여러 명이 동시에 인터넷을 접속하게 되므로 실제로 접속하는 호스트 숫자에 따라서 접속 속도가 느려질 수 있음