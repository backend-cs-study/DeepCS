# Chapter4.4 데이터베이스 종류

<br>

# 📚 목차

> **[1. 인덱스의 필요성](#인덱스의-필요성)**
>
> **[2. B-트리](#b-트리)**
> 
> **[3. 인덱스 만드는 방법](#인덱스-만드는-방법)**
> 
> **[4. 인덱스 최적화 기법](#인덱스-최적화-기법)**

<br>

## 인덱스의 필요성

인덱스는 데이터를 빠르게 찾을 수 있는 하나의 장치이다. 

<br>

## B-트리

인덱스는 보통 B-트리 자료 구조로 이루어져있다. 

- 루트 노드, 리프 노드, 브랜치 노드로 나뉜다. 

![Image](https://github.com/user-attachments/assets/fd7418cc-e8c3-4e61-85cc-6091898f00b1)


➡️ 정렬된 값을 기반으로 데이터를 탐색하여 빠르게 데이터를 찾을 수 있다. 

<br>

### 인덱스가 효율적인 이유와 대수확장성

- 단계를 거쳐 모든 요소에 접근할 수 있는 구조


- 트리 깊이 대수확장성 


> 💡 **대수 확장성**
> 
> `트리 깊이`가 **리프 노드 수에 비해 매우 느리게 성장**하는 것 
> 
> ➡️ 인덱스가 `한 깊이씩 증가`하면 최대 **인덱스 수**는 <ins>**4배 증가**</ins>한다. 

<br>

## 인덱스 만드는 방법
### MySQL

클러스터형 인덱스와 세컨더리 인덱스가 있다. 


#### 클러스터형 인덱스 

- 테이블당 하나를 설정할 수 있다. 


- primary key 옵션으로 `기본키`로 만들면 **클러스터형 인덱스를 생성**할 수 있다. 


- **기본키를 만들지 않고** `unique not null` 옵션을 붙이면 **클러스터형 인덱스로 만들 수 있다.** 

<br>

#### 세컨더리 인덱스


- create index 명령어를 기반으로 만들 경우 만들 수 있다. 


- `보조 인덱스`로 여러 개의 필드 값을 기반으로 **쿼리를 많이 보낼 때 생성해야하는 인덱스**이다. 

**[예시]**

age라는 하나의 필드만으로 쿼리를 보낸다면 ➡️ 클러스터 사용

age, email, name 등 다양한 필드를 기반으로 쿼리를 보낸다면 ➡️ 세컨더리 사용


> 💡 **하나의 인덱스를 만드는 것은 클러스터형 인덱스의 성능이 더 좋다.** 



<br>

### MongoDB

세컨더리키도 부가적으로 설정해서 기본키와 같이 쓰는 복합 인덱스를 설정할 수 있다. 

<br>

## 인덱스 최적화 기법
### 인덱스는 비용이다. 

- 인덱스는 2번 탐색(인덱스 리스트, 컬렉션 순)을 강요한다. 


- 또한, 컬렉션이 수정되었을 때 인덱스 수정도 필요한다. 

    ➡️ 이때, **트리의 높이를 조절하는 비용**, 데이터를 효율적으로 조회할 수 있도록 **분산시키는 비용**도 들게 된다. 


따라서 쿼리에 있는 필드에 <ins>인덱스를 무작정 설정하는 것은 답이 아니며</ins>, 컬렉션에서 가져와야하는 <ins>양이 많을 수록 인덱스를 사용하는 것은 `비효율적`</ins>이다. 

<br>

### 항상 테스팅하라

`explain()함수`를 통해 인덱스를 만들고 **쿼리를 보낸 이후 테스팅을 하며 걸리는 시간을 최소화**해야한다. 

> 💡**MySQL** 
> 
> ```mysql
> EXPLAIN
> SELECT * FROM t1
> JOIN t2 ON t1.c1 = t2.c1
> ```
> 
### 복합 인덱스는 같음, 정렬, 다중 값, 카디널리티 순이다. 

보통 **여러 필드를 기반**으로 조회할 때 `복합 인덱스 설정`

- 복합 인덱스는 <ins>생성할 때 순서</ins>가 있고 생성 **순서에 따라 인덱스의 성능이 달라진다.** 

    ➡️ 같음, 정렬, 다중 값, 카디널리티 순으로 생성


<br>

#### 같음

**equal이라는 쿼리**가 있다면 제일 먼저 인덱스로 설정 (== ❌)


<br>

#### 다중 값

쿼리 자체가 > , < 등 많은 값을 출력해야하는 쿼리에 쓰는 필드를 설정

<br>

#### 카디널리티 (유니크한 값의 정도)

**유니크 정도가 높은 순서를 기반**으로 인덱스를 생성해야한다. 

**[예시]**

age 보다 email이 더 높기 때문에 email을 먼저 생성