# Chapter2 네트워크

<br>

# 📚 목차

> **[1. 계층 구조](#계층-구조)**
>
> **[2. PDU](#pduprotocol-data-unit)**


<br>

## 계층 구조

> 💡 인터넷 프로토콜 스위트(Internet Protocol Suite)
>
> 인터넷에서 컴퓨터들이 서로 정보를 주고받는데 쓰이는 프로토콜의 집합
>
> 이를 **TCP/IP 4계층 모델**로 설명하거나 **OSI 7계층 모델**로 설명하기도 한다.

### TCP/IP 4계층 모델

네트워크에서 사용되는 **통신 프로토콜의 집합**으로 네트워킹 범위에 따라 `4개의 추상화 계층`으로 구성된다.

![Image](https://github.com/user-attachments/assets/116e3d45-d4c3-489a-981b-621785fd99c6)

> 💡 **OSI 7계층**
>
> **[TCP/IP 4계층과의 다른점]**
>
> - 애플리케이션 계층을 <ins>애플리케이션</ins>, <ins>프레젠테이션</ins>, <ins>세션</ins> 계층 3가지를 쪼갬
> - 링크 계층을 데이터 <ins>링크</ins>, <ins>물리</ins> 계층 2가지로 쪼갬
> - 인터넷 계층을 네트워크 계층으로 부른다.
>
> ➡️ 각 계층들은 **특정 계층이 변경되었을 때** <ins>다른 계층이 영향을 받지 않도록 설계</ins>되어 있다.

<br>

### 애플리케이션 계층
FTP, HTTP, SSH, SMTP, DNS 등 **응용 프로그램이 사용되는 프로토콜 계층**

➡️ 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 층

> 💡 **용어 설명**
>
> 1. **FTP (File Transfer Protocol)**
>
>  장치와 장치 간의 **파일을 전송**하는게 사용되는 표준 통신 프로토콜
>
> 2. **HTTP (HyperText Transfer Protocol)**
>
>   World Wide Web을 위한 **데이터 통신의 기초**이자 <ins>웹 사이트를 이용하는데 쓰는 프로토콜</ins>
>
> 
> 3. **SSH (Secure Shell)**
>
>   보안되지 않는 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 **암호화 네트워크 프로토콜**
>
> 
> 4. **SMTP (Simple Mail Transfer Protocol)**
>
>   전자 **메일 전송**을 위한 인터넷 표준 통신 프로토콜
>
> 
> 5. **DNS (Domain Name System)**
>
>   도메인 이름과 IP주소를 매핑해주는 서버 ➡️ IP 주소가 바뀌어도 사용자들에게 똑같은 도메인 주소로 서비스할 수 있다.
>
>   ![Image](https://github.com/user-attachments/assets/2814ab20-fe3c-4a6d-8645-125dd72f3158)

<br>

### 전송 계층

- `송신자`와 `수신자`를 연결하는 **통신 서비스를 제공**
- 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어를 제공
- 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 떄 **중계 역할**을 한다.

➡️ 대표적인 예: TCP, UDP ([TCP, UDP 계념 참고](https://velog.io/@clvl1004/Spring-%EB%84%A4%ED%81%AC%EC%9B%8C%ED%81%AC-%EA%B8%B0%EB%B3%B8-%EA%B0%9C%EB%85%90))

<br>

| 항목               | **TCP**                              | **UDP**                     |
|--------------------|--------------------------------------|-----------------------------|
| **순서 보장**      | ⭕                                    | ❌                           |
| **수신 여부 확인** | ⭕  (신뢰성 보장)                          | ❌ (수신 여부 확인하지 않음)           |
| **프로토콜 유형**  | 연결 지향 (Connection-oriented)          | 비연결 지향 (Connectionless)     |
| **패킷 교환 방식** | 가상회선 패킷 교환 방식      (순서 보장 ⭕)         | 데이터그램 패킷 교환 방식    (순서 보장 ❌) |
| **속도**           | 느림 (3 Way HandShake 방식)              | 빠름                          |
| **사용 예시**      | 웹(HTTP/HTTPS), 이메일(SMTP), 파일 전송(FTP) | 스트리밍, VoIP, 온라인 게임 등        |

<br>

#### 가상회선 패킷 교환 방식

각 패킷에는 **가상회선 식별자가 포함**되며 모든 패킷을 전송하면 가상회선이 해제되고 패킷들은 전송된 `'순서대로'` 도착하는 방식을 의미한다.

<br>

**[흐름]**

1. **통신 시작**  

    ➡️ **송신자 수신자** 사이의 `가상회선` 설정

<br>

2.  **데이터 전송**

    ➡️ 각 `패킷`은 **가상회선 식별자가 포함**되어 <ins>정해진 경로</ins>로만 이동

<br>

3. **목적지 도착**

   ➡️ 마지막 패킷까지 정상적으로 도달하면 **가상회선을 해제**한다. **(네트워크 자원 반납)**

<br>

> 💡**가상회선 설정** 
> 
> 송신자 ↔️ 수신자가 데이터를 주고 받을 때 **통신 하나**에 **하나의 가상회선이 설정**된다. (논리적인 고속도로 1개)
> 
> `통신을 보내는 동안` 모든 패킷은 해당 가상회선을 따라간다. 
> 
> ➡️ **패킷의 순서 보장**


<br>

#### 데이터그램 패킷 교환 방식

패킷이 **독립적으로 이동**하며 <ins>최적의 경로</ins>를 선택하여 가는데, 하나의 메세지에서 분활된 여러 패킷은 **서로 다른 경로로 전송될 수 있으며 도착한 순서가 다를 수 있다.** 


<br>


####  3 Way HandShake (TCP 연결 과정)

**[흐름]**

1. **SYN 단계**

    ➡️ 클라이언트는 서버에 자신의 ISN을 담아 SYN(SYNchronization, 연결 요청 플래그)을 보냄

    > 💡**ISN(Initial Sequence Numbers): 32 비트 고유 시퀀스 번호** 
    > 
    > TCP 연결의 첫번째 **패킷에 할당된 임의의 시퀀스 번호** (ex> 12010) 

<br>

2. **SYN + ACK 단계**

   ➡️ 서버는 클라이언트의 SYN을 수신하고 자신의 ISN을 보내며 `승인 번호`로 **클라이언트의 ISN + 1**을 보냄

<br>

3. **ACK 단계**

    ➡️ 클라이언트는 **서버의 ISN + 1**한 값인 `승인번호`를 담아 ACK(ACKnowledgement, 응답 플래그) 서버에 보냄

<br>


####  4 Way HandShake (TCP 연결 해제 과정)

**[흐름]**

1. **클라이언트의 연결 해제 희망**

   ➡️ 클라이언트가 연결을 해제하려 할 때 FIN으로 설정된 세그먼트를 보냄

   ➡️ 클라이언트는 `FIN_WAIT_1` 상태로 들어가 **서버의 응답을 기다림**

<br>

2. **서버의 연결 해제 승인**

   ➡️ 서버는 클라이언트로 ACK라는 승인 세그먼트 전송

   ➡️ 서버는 `CLOSE_WAIT` 상태에 들어가고 **클라이언트가 세그먼트를 받으면** `CLOSE_WAIT_2 상태`로 들어감

<br>

3. **연결 해제 준비 완료**

   ➡️ 서버는 ACK를 보내고 `일정 시간 이후` **클라이언트에 FIN이라는 세그먼트를 보냄**

<br>

4. **연결 해제**

   ➡️ 클라이언트는 `TIME_WAIT 상태`가 되고 다시 서버로 ACK를 보내면 서버는 CLOSED 상태가 됨 

   ➡️ 클라이언트는 **어느 정도 시간을 대기한 후 연결이 닫히고** 클라이언트와 서버의 <ins>모든 자원의 연결이 해제된다. 

> 💡 **TIME_WAIT(일정 시간 후 연결을 닫는 이유)**
> 
> 우분투: 60초, 윈도우: 4분으로 설정 (OS마다 다름)
> 
> - **지연 패킷이 발생한 경우를 대비**
>
>   ➡️ 데이터 무결성 방지
> 
> 
> - **장치 연결을 닫힘 여부 확인**
>
>   ➡️ `LAST_ACK 상태(연결 해제 준비 완료)`에서 닫힐 경우 다시 새로운 연결을 하려고 할 때 **접속 오류가 나타난다.** 

<br>

### 인터넷 계층

장치로부터 받은 네트워크 `패킷`을 **IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층** 

- IP, ARP, ICMP 등이 있다.
- 패킷을 수신해야할 상대의 <ins>주소를 지정하여 데이터를 전달 
- **비연결형적인** 특징을 가진다. 

<br>

### 링크(네트워크 접근) 계층

전선, 관섬유, 무선 등으로 **실질적으로 데이터를 전달**하며 장치간에 신호를 주고받는 `규칙`을 전하는 계층이다.

- 물리 계층
    
    ➡️ 무선 LAN과 유선 LAN을 통해 0,1로 이루어진 데이터를 보내는 계층




- 링크 계층

  ➡️ '이더넷 프레임'을 통해 에러확인, 흐름 제어, 접근 제어를 담당하는 계층


<br>

### 📎유선 LAN(IEEE802.3)

유선 LAN을 이루는 이더넷은 IEEE802.3 프로토콜을 따른다. 

➡️ **전이중화 통신**

<br>

#### 전이중화(Full Duplex) 통신 (현대 통신 방식)

양쪽 장치가 동시에 송수신할 수 있는 방식

➡️ 송신로와 수신로로 나눠서 데이터를 주고 받는다. 


<br>

### 📎유선 LAN을 이루는 케이블 

TP 케이블이라고 하는 **트위스트 페어 케이블**과 광**섬유 케이블**이 대표적

<br>

#### 트위스트 페어 케이블 

여덟개의 구리선을 두개씩 꼬아서 묶는 케이블

![Image](https://github.com/user-attachments/assets/3b231811-5f8f-45ae-a655-d86d4aa258ac)

<br>

**[종류]**

![Image](https://github.com/user-attachments/assets/9403cb3f-3f46-4674-a1da-91c1135b048f)

> 💡 **LAN 케이블을 꽂을 수 있는 커넥터를 RJ-45 커넥터라고 한다.** 

<br>

#### 광섬유 케이블

- 레이저를 이용해 통신하기 때문에 구리선과는 비교할 수 없을 만큼의 **장거리 및 고속 통신이 가능** 
- 보톤 100GBPS의 데이터를 전송

> 💡 **원리** 
> 
> 광섬유 `내부`와 `외부`를 다른 밀도를 가지는 `유리`나 `플라스틱 섬유`로 제작해서 **한 번 들어간 빛이 내부에서 계속적으로 반사하며 전진**하여 반대편 끝까지 가는 원리 
>
> ![Image](https://github.com/user-attachments/assets/75d4e1dc-31de-49d4-9719-84a65d1b1401)

<br>

### 📎무선 LAN

수신과 송신에 같은 채널 사용 

➡️ **반이중화 통신**

#### 반이중화(Half Duplex) 통신 (이전 통신 방식)

양쪽 장치가는 서로 통신할 수 있지만 동시에는 통신할 수 없으며, **한 번에 한 방향만 통신**할 수 있는 방식

![Image](https://github.com/user-attachments/assets/7e5128a5-b65b-4d8e-80a2-c897ae35545b)

<br>

#### CSMA/CA

데이터를 `보내기 전`에 **일련의 과정을 기반**으로 사전에 가능한 한 <ins>충돌을 방지하는 방식

**[과정]**

1. 사용 중인 채널이 있다면 다른 채널을 감지하다 `유후 상태`인 채널 발견 


2. IFS(InterFrame Space, 프레임 간 공간 시간)만큼 기다린다. 
    > 💡 **IFS** 
    >
    > 프레임의 **우선 순위를 정의**할 때도 사용
    >
    > ➡️ IFS가 낮으면 우선순위가 높다.  


3. 프레임을 보내기 전 0 ~2^k -1  사이에서 결정된 **램덤 상수를 기반으로 결정된 시간**만큼 기다린 뒤 프레임을 보낸다. 


4. 프레임을 보낸 뒤 제대로 송신이 되었고 ACK 세그먼트를 받았다면 과정을 마친다. 

> 💡 **ACK를 받지 못한 경우**
> 
> k = k + 1을 하며 과정을 반복하다가 k가 정해진 Kmax보다 더 커진다면 해당 프레임 전송을 버린다. 


<br>

#### CSMA/CD 

데이터를 `보낸 이후` **충돌이 발생**한다면 일정 시간 이후 **재전송하는 방식**

**한 경로를 기반**으로 데이터를 보내기 때문에 <ins>데이터를 보낼 때 충돌에 대비</ins>해야한다. ➡️ 재시도

<br>

### 📎무선 LAN을 이루는 주파수 

무선 LAN은 **무선 신호 전달 방식**을 이용하여 2대 이상의 장치를 연결하는 기술 

- 매체인 공기에 주파수를 쏘아 무선 통신망을 구축
- 2.4GHz 대역 or **5GHz 대역** 사용
    > 💡**2.4GHz 대역**: 장애물에 강하지만 전자레인지, 무선 등 전파 간섭이 일어나는 경우가 많다. 

  > 💡**5GHz 대역**: 사용 가능한 채널 수도 많고 동시에 사용할 수 있기 때문에 상대적으로 깨끗한 전파 환경을 구축할 수 있다.


<br>

#### 와이파이

전자기기들이 무선 LAN 신호에 연결할 수 있게 하는 기술 **(무선 접속 장치(공유기, AP) 필요)**

공유기를 통해 **유선 LAN에 흐르는 신호**를 **무선 LAN 신호로 바꿔주어** <ins>신호가 닿는 범위 내에서 무선 인터넷을 사용</ins>할 수 있게 된다. 


<br>

#### BSS (Basic Service Set)

동일 BSS 내에 있는 AP들과 장치들이 서로 통신이 가능한 구조를 말한다. 

- 근거리 무선 통신 제공
- 하나의 AP만을 기반으로 구축
- 사용자가 한 곳에서 다른 곳으로 **자유롭게 이동하며 네트워크에 접속하는 것은 불가능**


<br>

#### ESS

하나 이상의 연결된 BSS 그룹 

- 장거리 무선 통신 제공
- BSS보다 더 많은 가용성과 이동성 지원
- 사용자는 한 장소에서 다른 장소로 이동하며 **중단 없이 네티워크에 계속 연결**

![Image](https://github.com/user-attachments/assets/9ee604b3-d732-4be0-a0bf-e6bca94ae42f)

<br>

### 📎이더넷 프레임

![Image](https://github.com/user-attachments/assets/3a999502-037a-4c29-900b-c26fa34d22ac)


> 💡 **MAC 주소**
> 
> 각 장치의 **LAN카드를 구별하기 위한 식별번호** (6바이트, 48비트로 구성)

<br>

### 계층 간 데이터 송수신 과정

![Image](https://github.com/user-attachments/assets/fc4c1a3a-c5e3-445b-a9d9-cc3a99f8a68d)

1. 애플리케이션 계층 ➡️ 전송 계층: **요청 값들이 캡슐화 과정을 거쳐 전달**


2. 링크 계층: **서버와 통신**


3. 해당 서버의 링크 계층 ➡️ 애플리케이션: **비캡슐화 과정을 거쳐 데이터 전송**

> 💡 **캡슐화 과정**
> 
> `상위 헤더`와 `데이터`를 **하위 계층의 데이터 부분에 포함**시키고 <ins>해당 계층의 헤더를 삽입</ins>하는 과정 
> 
> ![Image](https://github.com/user-attachments/assets/ae45d0ea-ac62-4869-b273-e1f3994a8893)
> 
> 1번 과정에서 '세그먼트' 또는 '데이터 그램'화되며 `TCP(L4) 헤더`가 붙여진다. 
> 
> **인터넷 계층**으로 가면서 `IP(L3)헤더`가 붙여지게되며, <ins>패킷화</ins>가 된다. 
> 
> **링크 계층**으로 전달되면서 `프레임 레더`와 `프레임 트레일러`가 붙어 <ins>프레임화</ins>가 된다. 

<br>

> 💡 **비캡슐화 과정**
>
> 하위 계층에서 상위 계층으로 가며, 각 계층의 헤더 부분을 제거하는 과정 
> 
> 캡슐화의 반대 과정이며, 사용자에게 애플리케이션의 PDU인 메시지로 전달된다. 
> 
> ![Image](https://github.com/user-attachments/assets/855af324-8969-4ef0-a6a0-e906eaab53ab)

<br>

## PDU(Protocol Data Unit)

네트워크의 어떠한 `계층에서 계층으로 데이터가 전달될 때` **한 덩어리의 단위**를 의미한다. 

- 제어 관련 정보들이 포함된 **헤더**, 데이터를 의미하는 **페이로드**로 구성되어 있다.
- 계층마다 부르는 명칭이 다르다. 

**[명칭]**

`애플리케이션 게층`: 메시지(문자열 기반)

`전송 계층` : 세그먼트(TCP), 데이터 그램(UDP)

`인터넷 계층`: 패킷

`링크 계층`: 프레임(데이터 링크 계층), **비트(물리 계층)** 

<br>

> 💡 아래 계층인 비트로 송수신하는 것이 모든 PDU 중 가장 빠르고 효율성이 높다. 

> 💡 **애플리케이션 계층에서 문자열 기반의 PDU를 사용하는 이유**
> 
> ➡️ 헤더에 authorization 값 등 다른 값들을 넣는 **확장이 쉽다.** 