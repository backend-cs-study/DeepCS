# 2.4 IP 주소

# 2.4.1 ARP

## ARP(Address Resolution Protocol)
✔️ 설명 <br>
- IP 주소로부터 MAC 주소를 구하는 IP와 MAC 주소의 다리 역할을 하는 프로토콜
- ARP를 통해 가상 주소인 IP 주소를 실제 주소인 MAC 주소로 변환함
- RARP를 통해 실제 주소인 MAC 주소를 가상 주소인 IP 주소로 변환함

✔️ 용어 <br>
- 브로드캐스트 : 송신 호스트가 전송한 데이터가 네트워크에 연결된 모든 호스트에 전송되는 방식
- 유니캐스트 : 고유 주소로 식별된 하나의 네트워 목적지에 1:1로 데이터를 전송하는 방식

---
# 2.4.2 홉(hop)바이홉 통신
✔️ 설명 <br>
- IP 주소를 통해 통신하는 과정
- 홉(hop) : 건너뛰는 모습 의미
- 통신망에서 각 패킷이 여러 개의 라우터를 건너가는 모습을 비유적으로 표현한 것
- 수많은 서브네트워크 안에 있는 라우터의 라우팅 테이블 IP를 기반으로 패킷을 전달하고 또 전달해나가며 라우팅을 수행하며 최종 목적지까지 패킷을 전달함
- 즉, 통신 장치에 있는 '라우팅 테이블'의 IP를 통해 시작 주소부터 시작하여 다음 IP로 계속 이동하는 '라우팅' 과정을 거쳐 패킷이 최종 목적지까지 도달하는 통신

✔️ 용어 <br>
- 라우팅 : IP 주소를 찾아가는 과정

## 라우팅 테이블(routing table)
- 송신지에서 수신지까지 도달하기 위해 사용되며
- 라우터에 들어가 있는 목적지 정보들과 그 목적지로 가기 위한 방법이 들어 있는 리스트를 뜻함
- 라우팅 테이블에는 게이트웨이와 모든 목적지에 대해 해당 목적지에 도달하기 위해 거쳐야 할 다음 라우터의 정보를 가지고 있습니다.

## 게이트웨이(gateway)
- 서로 다른 통신망, 프로토콜을 사용하는 네트워크 간의 통신을 가능하게 하는 관문 역할을 하는 컴퓨터나 소프트웨어를 두루 일컫는 용어
- 사용자는 인터넷에 접속하기 위해 수많은 톨게이트인 게이트웨이를 거쳐야 하며
- 게이트웨이는 서로 다른 네트워크상의 통신 프로토콜을 변환해주는 역할을 하기도 함
- 게이트웨이를 확인하는 방법 : 라우팅 테이블을 통해 볼 수 있음
- 라우팅 테이블은 윈도우의 명령 프롬프트에서 netstat -r 명령어를 실행하여 확인 가능
- IPv4, IPv6 경로 테이블이 바로 라우팅 테이블

---
# 2.4.3 IP 주소 체계
- IP 주소는 IPv4와 IPv6으로 나뉨
- IPv4 : 32비트를 8비트 단위로 점을 찍어 표기
- 123.45.67.89 같은 방식으로 IP 주소 나타냄
- IPv6 : 64비트를 16비트 단위로 점을 찍어 표기
- 2001:db8:ff00:42:8329 같은 방식으로 IP 주소 나타냄

## 클래스 기반 할당 방식(classful network addressing)
✔️ 설명 <br>
- A, B, C, D, E 다섯 개의 클래스로 구분하는 방식
- 앞에 있는 부분 : 네트워크 주소
- 그 뒤에 있는 부분 : 컴퓨터에 부여하는 주소인 호스트 주소로 놓아서 사용
- 클래스 A, B, C는 일대일 통신으로 사용되고
- 클래스 D는 멀티캐스트 통신,
- 클래스 E는 앞으로 사용할 예비용

✔️ 특징 <br>
- 구분 비트 : 맨 왼쪽에 있는 비트, 이를 통해 클래스 간의 IP가 나눠짐
- 네트워크의 첫 번째 주소는 네트워크 주소로 사용됨
- 가장 마지막 주소는 브로드캐스트용 주소로 네트워크에 속해 있는 모든 컴퓨터에 데이터를 보낼 때 사용됨
- 하지만 이 방식은 사용하는 주소보다 버리는 주소가 많은 단점
- 이를 해소하기 위해 DHCP, IPv6, NAT가 나옴

## DHCP(Dynamic Host Configuration Protocol)
- IP 주소 및 기타 통신 매개변수를 자동으로 할당하기 위한 네트워크 관리 프로토콜
- 이 기술을 통해 네트워크 장치의 IP 주소를 수동으로 설정할 필요 없이
- 인터넷에 접속할 때마다 자동으로 IP 주소를 할당할 수 있습니다.
- 많은 라우터와 게이트웨이 장비에 DHCP 기능이 있으며
- 이를 통해 대부분의 가정용 네트워크에서 IP 주소를 할당함

## NAT(Network Address Translation)
- 패킷이 라우팅 장치를 통해 전송되는 동안 패킷의 IP 주소 정보를 수정하여 IP 주소를 다른 주소로 매핑하는 방법
- IPv4 주소 체계만으로는 많은 주소들을 모두 감당하지 못하는 단점이 있음
- 이를 해결하기 위해 NAT로 공인 IP와 사설 IP로 나눠서 많은 주소 처리함
- NAT 가능하게 하는 소프트 웨어 : ICS, RRAS, Netfilter

### 공유기와 NAT
- NAT를 쓰는 이유 : 주로 여러 대의 호스트가 하나의 공인 IP 주소를 사용하여 인터넷에 접속하기 위함

### NAT를 이용한 보안
- NAT를 이용하면 내부 네트워크에서 사용하는 IP 주소와 외부에 드러나는 IP 주소를 다르게 유지할 수 있기 때문에
- 내부 네트워크에 대한 어느 정도의 보안이 가능해짐

### NAT의 단점
- NAT는 여러 명이 동시에 인터넷을 접속하게 되므로
- 실제로 접속하는 호스트 숫자에 따라서 접속 속도가 느려질 수 있다는 단점이 있음

---
# 2.4.4 IP 주소를 이용한 위치 정보
- IP 주소는 인터넷에서 사용하는 네트워크 주소이기 떄문에
- 이를 통해 동 또는 구까지 위치 추적이 가능

---
## ✅ IP 주소 관련 면접 질문과 답변

### 🔸 Q1. ARP란 무엇이며 언제 사용되나요?

✅ **답변**:
- ARP(Address Resolution Protocol)는 IP 주소를 실제 물리적인 MAC 주소로 변환해주는 프로토콜입니다. 
- 예를 들어, 내 컴퓨터가 같은 네트워크 내 다른 컴퓨터로 데이터를 보낼 때 IP는 알지만 MAC 주소를 모르면 ARP 요청을 통해 MAC 주소를 알아냅니다. 
- 이 과정은 네트워크 계층(IP)에서 데이터 링크 계층(MAC)으로 매핑할 때 사용됩니다.

### 🔸 Q2. 홉(hop) 바이 홉 통신이란 무엇인가요?

✅ **답변**:
- 홉(hop)은 네트워크 장치(예: 라우터) 하나를 통과하는 것을 의미합니다. 
- 홉 바이 홉 통신은 IP 패킷이 목적지까지 여러 라우터를 거쳐 이동하는 것을 뜻하며, 각 라우터는 라우팅 테이블을 참조하여 다음 목적지로 패킷을 전달합니다. 
- 이는 라우팅이라는 과정에 기반해 이뤄집니다.

### 🔸 Q3. 라우팅 테이블과 게이트웨이의 역할을 설명해보세요.

✅ **답변**:
- 라우팅 테이블은 목적지 IP 주소에 따라 데이터를 어떤 경로로 보낼지를 정하는 정보 목록입니다. 
- 게이트웨이는 서로 다른 네트워크 간의 통신을 가능하게 해주는 중간 지점으로, 기본 게이트웨이는 외부 네트워크로 나갈 때의 출입구 역할을 합니다. 
- 라우팅 테이블을 통해 어떤 게이트웨이를 사용할지 결정합니다.

### 🔸 Q4. IPv4와 IPv6의 차이점은 무엇인가요?

✅ **답변**:
IPv4는 32비트 주소 체계로 약 43억 개의 주소를 표현할 수 있고, 점(dot)으로 구분된 4개의 8비트 십진수(예: 192.168.0.1)로 구성됩니다. IPv6는 128비트 체계로, 16비트 단위의 8개 블록을 콜론(:)으로 구분하며(예: 2001\:db8::1), 주소 고갈 문제를 해결하고 보안과 효율성도 향상시켰습니다.

### 🔸 Q5. 클래스 기반 IP 주소(Classful Addressing)란 무엇인가요?

✅ **답변**:
- 클래스 기반 주소는 IP를 A\~E 클래스로 나누어 네트워크/호스트 구분을 단순화한 방식입니다. 
- A, B, C 클래스는 일반 통신용이며, D는 멀티캐스트, E는 실험용입니다. 
- 하지만 비효율적으로 낭비되는 주소가 많아 현재는 비추천되며, CIDR, DHCP, NAT 등이 이를 대체합니다.

### 🔸 Q6. DHCP의 역할은 무엇인가요?

✅ **답변**:
- DHCP(Dynamic Host Configuration Protocol)는 장치가 네트워크에 연결될 때 IP 주소, 서브넷 마스크, 게이트웨이 등의 설정을 자동으로 할당하는 프로토콜입니다. 
- 수동 설정을 줄여주고, 효율적인 IP 자원 관리를 가능하게 합니다.

### 🔸 Q7. NAT(Network Address Translation)는 무엇이며, 왜 필요한가요?

✅ **답변**:
- NAT는 하나의 공인 IP 주소를 사용해 내부 사설 네트워크의 여러 장치가 인터넷에 접속할 수 있게 해주는 기술입니다. 
- IPv4 주소 고갈 문제를 해결하고, 내부 주소를 외부에 노출하지 않기 때문에 보안성도 어느 정도 확보됩니다. 
- 하지만 다수가 동시에 사용할 경우 속도 저하가 생길 수 있습니다.

### 🔸 Q8. ARP와 RARP의 차이점을 설명하세요.

✅ **답변**:
- ARP는 IP 주소로부터 MAC 주소를 찾는 프로토콜이고, RARP는 MAC 주소로부터 IP 주소를 찾습니다. 
- ARP는 일반적인 네트워크 통신에서 주로 사용되고, RARP는 초기 부팅 시 IP를 알지 못하는 디바이스가 자신의 IP를 알아내기 위해 사용됩니다.

### 🔸 Q9. 하나의 IP 주소로 사용자 위치를 알 수 있는 범위는?

✅ **답변**:
- IP 주소를 통해 일반적으로 동/구 정도의 위치까지 추적할 수 있습니다. 
- 이는 ISP가 할당한 IP 블록을 기반으로 추정되며, 정확한 실시간 위치 추적은 불가능하지만 대략적인 지역은 파악할 수 있습니다.

### 🔸 Q10. NAT를 사용한 환경에서 발생할 수 있는 문제점은?

✅ **답변**:
- NAT는 다수의 장비가 하나의 공인 IP를 공유하게 하므로, 포트 충돌이나 세션 관리의 어려움이 생길 수 있습니다. 
- 또한, 실시간 통신이 필요한 VoIP, P2P 서비스에서 연결 문제가 발생할 수 있습니다.

---
## ✅ IP 주소/라우팅 관련 심화 질문과 답변
### 🔹 Q1. ARP는 어떤 계층에서 동작하며, 백엔드 개발자가 이 개념을 알아야 하는 이유는 무엇인가요?

**답변:**
- ARP는 네트워크 계층(IP)과 링크 계층(MAC) 사이에서 동작하는 프로토콜로, IP 주소를 실제 통신 가능한 MAC 주소로 변환합니다.
- 백엔드 서버 간 통신, 특히 동일 네트워크 내 마이크로서비스 호출 시 ARP 테이블 문제나 DNS→ARP 지연이 발생할 수 있기 때문에 이해하고 있어야 합니다.

### 🔹 Q2. IP 충돌이 발생하면 백엔드 시스템엔 어떤 문제가 생기나요?

**답변:**
- IP 충돌은 동일 네트워크에 중복된 IP가 존재해 패킷이 엉뚱한 장치에 도달하는 문제로, 서버 간 통신 오류, DB 연결 실패, API 요청 타임아웃 등을 유발합니다. 
- 특히 고정 IP로 설정된 서버 환경에서 종종 발생하므로, DHCP 환경과 고정 IP 환경을 분리하는 전략이 필요합니다.

### 🔹 Q3. NAT 환경에서 웹 서버를 구성할 때 고려해야 할 점은?

**답변:**
- NAT는 사설 IP를 공인 IP로 매핑하므로, 외부에서 접근 가능한 서버는 포트포워딩 설정이 필요합니다. 
- 또한 외부 요청자의 IP가 동일하게 보일 수 있어, 요청자의 실제 IP 추출을 위해 `X-Forwarded-For` 헤더를 로깅에 포함시켜야 합니다.

### 🔹 Q4. 라우팅 테이블은 어떤 경우에 확인하게 되며, 백엔드 개발자가 확인해야 할 상황은?

**답변:**
- 라우팅 테이블은 특정 서버가 트래픽을 어디로 보낼지 결정하는 경로 정보입니다. 
- 백엔드 개발자는 VPN, 사설망, 멀티 AZ 환경에서 네트워크 단절이나 경로 오류 발생 시 `netstat -r`, `ip route` 등으로 트래픽 경로를 확인할 수 있어야 합니다.

### 🔹 Q5. DHCP 서버가 불안정하면 백엔드 서비스에 어떤 영향을 미칠 수 있을까요?

**답변:**
- DHCP는 IP를 동적으로 할당하는데, 서버가 갑작스레 IP를 잃거나 갱신 실패 시 네트워크 연결이 끊겨 서비스 장애로 이어질 수 있습니다. 
- 이를 방지하려면 서버는 정적 IP를 사용하거나 DHCP 할당을 예약해야 합니다.

### 🔹 Q6. NAT 환경에서는 어떤 문제가 발생할 수 있으며, 백엔드 개발자가 이를 어떻게 해결해야 하나요?

**답변:**
- NAT는 여러 내부 장치를 하나의 공인 IP로 나가기 때문에, 클라이언트 식별이 어렵고, 연결 지연이 발생할 수 있습니다. 
- 해결 방법으로는:
  * JWT에 식별자 부여
  * WebSocket 대신 polling
  * 서버간 연결 시 VPN 터널 사용
    등이 있습니다.

### 🔹 Q7. 홉(hop) 수가 많은 환경에서는 어떤 문제가 생기며, 백엔드에서 고려할 사항은?

**답변:**
- 홉 수가 많을수록 지연(latency), 패킷 손실 가능성이 높습니다. 
- 백엔드에서 고려해야 할 점은 다음과 같습니다:
  * `Time-to-Live` 설정 확인 (패킷 수명)
  * API 요청 timeout 최적화
  * CDN, 지역 서버 분산 구조 사용

### 🔹 Q8. IPv6 도입이 왜 필요한가요? 백엔드 서비스와 관련지어 설명해보세요.

**답변:**
- IPv4 주소 부족 문제로, 특히 IoT, 모바일 환경에서 충돌 및 NAT 한계가 자주 발생합니다. 
- IPv6는 더 많은 주소 제공 외에도 보안(IPSec), 효율적인 라우팅 측면에서 유리하며, 
- 백엔드 서버는 이를 지원하기 위한 이중 스택 구성(IPv4+IPv6)을 고려해야 합니다.
---

좋습니다. 아래는 **IP 주소, ARP, 라우팅, NAT, DHCP 등과 관련된 면접 예상 시나리오**와 **꼬리 질문 + 답변** 세트를 **백엔드 개발자 기준**으로 구성한 예시입니다. 실제 기술면접처럼 구성했으며, 논리적 흐름과 기술적 깊이를 점차 심화시켜갑니다.

---

**\[면접 예상 시나리오 1: 네트워크 기초와 실무 적용]**

**면접관 질문:**
“클라이언트에서 서버로 요청을 보낼 때 IP 주소는 어떻게 MAC 주소로 변환되나요?”

**지원자 답변:**
“이 과정에서 ARP(Address Resolution Protocol)가 사용됩니다. IP는 논리적 주소지만, 실제 네트워크에서 통신하려면 목적지의 MAC 주소가 필요합니다. 이때, 호스트는 먼저 자신의 ARP 캐시를 확인하고, 없으면 브로드캐스트로 ARP 요청을 보내고, 응답을 받아 MAC 주소를 알아냅니다.”

**꼬리 질문 1:**
“그럼 서버의 MAC 주소는 클라이언트가 어떻게 알고 있나요?”

**답변:**
“같은 서브넷에 있는 경우에는 직접 ARP 요청을 통해 MAC 주소를 알아낼 수 있지만, 다른 네트워크에 있다면 게이트웨이의 MAC 주소를 알아내고 그쪽으로 먼저 패킷을 전송합니다. 이후 라우터들이 IP를 기준으로 다음 홉으로 계속 전달하게 됩니다.”

**꼬리 질문 2:**
“라우팅 테이블에 목적지가 없으면 어떻게 되나요?”

**답변:**
“기본 게이트웨이(Default Gateway) 설정이 되어 있으면, 해당 패킷은 기본 게이트웨이로 전달됩니다. 거기서 다시 라우팅 테이블 기반으로 전달 경로를 결정합니다. 만약 기본 게이트웨이도 없다면 해당 패킷은 폐기됩니다.”

---

**\[면접 예상 시나리오 2: 백엔드 실무 관점]**

**면접관 질문:**
“회사에서 사용하는 서버가 고정 IP가 아니라 매번 바뀌는 것 같아요. 이런 현상은 왜 발생할까요?”

**지원자 답변:**
“이는 DHCP(Dynamic Host Configuration Protocol)가 활성화되어 있기 때문입니다. DHCP는 IP를 자동으로 임대해서 설정해주는 프로토콜인데, 리스 시간이 지나면 다른 IP가 할당될 수 있습니다.”

**꼬리 질문 1:**
“그럼 백엔드 서버에서 이 문제를 방지하려면 어떻게 하죠?”

**답변:**
“고정 IP를 사용하거나, DHCP 서버에 MAC 주소를 등록해서 항상 동일한 IP를 할당하도록 설정하는 DHCP 예약 기능을 사용할 수 있습니다.”

**꼬리 질문 2:**
“프라이빗 클라우드 환경에서는 이런 설정을 어떻게 하나요?”

**답변:**
“클라우드 네트워크에서는 보통 VPC 내에서 사설 IP를 고정하거나, EIP(Elastic IP) 같은 고정 공인 IP를 부여해서 문제를 해결합니다.”

---

**\[면접 예상 시나리오 3: 보안과 NAT]**

**면접관 질문:**
“요즘 NAT 많이 쓰잖아요. 보안상 이점이 있다고들 하던데 왜 그런가요?”

**지원자 답변:**
“NAT(Network Address Translation)는 내부 사설 IP를 외부에 직접 노출하지 않기 때문에 외부에서 직접 내부 시스템에 접근하기 어렵습니다. 이로 인해 1차적인 보안막 역할을 합니다.”

**꼬리 질문 1:**
“그렇다면 NAT가 있다고 방화벽은 필요 없는가요?”

**답변:**
“아닙니다. NAT는 주소를 변환해주는 역할일 뿐, 접근 통제를 하지는 않습니다. 방화벽은 포트/패킷 필터링 등의 보안 정책을 적용하는 역할이라 별도로 반드시 필요합니다.”

**꼬리 질문 2:**
“NAT를 쓸 때 문제가 생기는 경우는 없나요?”

**답변:**
“있습니다. 예를 들어 P2P나 VoIP처럼 연결을 상호적으로 설정해야 하는 애플리케이션에서는 NAT로 인해 세션 설정이 어려워질 수 있습니다. 이때는 포트 포워딩, STUN/TURN 서버 등을 추가적으로 사용해야 합니다.”

---

**\[면접 예상 시나리오 4: 실시간 장애 대응]**

**면접관 질문:**
“운영 중인 백엔드 서버에서 특정 유저만 응답이 느리다고 합니다. 네트워크 문제를 의심할 때 어떻게 진단할 수 있을까요?”

**지원자 답변:**
“우선 해당 유저의 IP 기준으로 ping 테스트를 해보고, 지연이나 손실 여부를 확인합니다. 이후 traceroute로 경로를 확인해서 어느 지점에서 지연이 발생하는지 파악합니다. 동시에 서버 측에서는 netstat로 세션 상태, SYN\_RECV 등의 연결 수치를 확인할 수 있습니다.”

**꼬리 질문 1:**
“Traceroute에서 중간 홉이 응답을 안 하면 어떻게 하시겠어요?”

**답변:**
“일부 라우터는 ICMP 패킷에 응답하지 않도록 설정되어 있을 수 있습니다. 그래서 응답이 없어도 꼭 장애라고 단정할 수는 없습니다. 로그나 모니터링 도구 등을 추가로 활용해 확인합니다.”
