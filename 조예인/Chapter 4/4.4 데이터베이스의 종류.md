# 4.4 데이터베이스의 종류

# 4.4.1 관계형 데이터베이스(RDBMS)
- 행과 열을 가지는 표 형식 데이터를 저장하는 형태의 데이터베이스를 가리키며 
  - SQL이라는 언어를 써서 조작함 
  - MySQL, PostgreSQL, 오라클, SQL Server, MSSQL 등이 있음 
- 참고로 관계형 데이터베이스의 경우 표준 SQL은 지키기는 하지만,
  - 각각의 제품에 특화시킨 SQL을 사용함 
- ex) 오라클의 경우 PL/SQL이라고 하며 SQL Server에서는 T-SQL, MySQL은 SQL을 사용

## MySQL
- 대부분의 운영체제와 호환되며 현재 가장 많이 사용하는 데이터베이스
- 스택 오버플로우 링크: https://insights.stackoverflow.com/survey/2021#most-popular-technologies-database

✔️ 그림 4-29 스택 오버플로우 조사 결과  <br>

<img src="https://github.com/user-attachments/assets/3c3cb443-6120-4eff-8cef-c063fe0499ff" width="400"/>

- 스택 오버플로우에서 조사한 결과(2021)에서 MySQL은 아직도 압도적으로 가장 많이 쓰는 데이터베이스이며 
  - 메타, 트위터 등 많은 기업에서 MySQL을 사용하고 있음
- C. C++로 만들어졌으며 
  - MyISAM 인덱스 압축 기술, 
  - B-트리 기반의 인텍스, 
  - 스레드 기반의 메모리 할당 시스템, 
  - 매우 빠른 조인, 
  - 최대 64개의 인데스를 제공함 
- 대용량 데이터베이스를 위해 설계되어 있고 
  - 롤백, 커밋, 이중 암호 지원 보안 등의 기능을 제공하며 많은 서비스에서 사용함

✔️ 그림 4-30 MySQL 스토리지 엔진 아키텍처  <br>

<img src="https://github.com/user-attachments/assets/3dcccc52-02ac-4eb9-b7cd-4912a335609b" width="400"/>

- 데이터베이스의 심장과도 같은 역할을 하는 곳이 바로 스토리지 엔진인데, 
  - 모듈식 아키텍처로 쉽게 스토리지 엔진을 바꿀 수 있으며 
  - 데이터 웨어하우징, 트랜잭션 처리, 고가용성 처리에 강점을 두고 있음 
- 스토리지 엔진 위에는 커넥터 API 및 서비스 계층을 통해 MySQL 데이터베이스와 쉽게 상호 작용할 수 있음
- 또한, MySQL은 쿼리 캐시를 지원해서 입력된 쿼리 문에 대한 전체 결과 집합을 저장하기 때문에 
  - 사용자가 작성한 쿼리가 캐시에 있는 퀴리와 동일하면 
  - 서버는 단순히 구문 분석, 최적화 및 실행을 건너뛰고 캐시의 출력만 표시함

## PostgreSQL
- PostgreSQL은 MySQL 다음으로 개발자들이 선호하는 데이터베이스 기술로 널리 인정받고 있음
- 특징 : 디스크 조각이 차지하는 영역을 회수할 수 있는 장치인 VACUUM 
- 최대 테이블의 크기는 32TB이며 SQL뿐만 아니라 JSON을 이용해서 데이터에 접근가능 
- 지정 시간에 복구하는 기능, 로깅, 접근 제어, 중첩된 트랜잭선, 백업 등 가능

---

# 4.4.2 NoSQL 데이터베이스
- NoSQL(Not only SQL)이라는 슬로진에서 생겨난 데이터베이스
  - SQL을 사용하지 않는 데이터베이스를 말하며, 
  - 대표적으로 MongoDB와 redis 등이 있음

## MongoDB
- MongoDB는 JSON을 통헤 데이터에 첩근할 수 있고, 
  - Binary JSON 형태(BSON)로 데이터가 저장되며 
  - 와이어드타이거 엔진이 기본 스토리지 엔진으로 장착된 키-값 데이터 모델에서 확장된 도큐먼트 기반의 데이터베이스
- 확장성이 뛰어나며 빅데이터를 저장할 때 성능이 좋고 고가용성과 샤딩, 레플리카셋을 지원함 
- 또한, 스키마를 정해 놓지 않고 데이터를 삽입할 수 있기 때문에 
  - 다양한 도메인의 데이터베이스를 기반으로 분석 하거나 로깅 등을 구현할 때 강점을 보임
- 또한, MongoDB는 도큐먼트를 생성할 때마다 다른 컬렉션에서 중복된 값을 지니기 힘든 유니크한 값인 ObjectID가 생성됩니다.

✔️ 그림 4-33 MongoDB ObjectID  <br>

<img src="https://github.com/user-attachments/assets/7c6f6ed8-51f5-4e21-8b8d-1365ca33df82" width="400"/>

- 이는 기본키로 유닉스 시간 기반의 타임스탬프(4바이트), 랜덤 값(5바이트), 카운터(3바이트)로 이루어져 있음

## redis
- redis는 인메모리 데이터베이스이자 키-갔 데이터 모델 기반의 데이터베이스
- 기본적인 데이터 타입은 문자열(string)이며 최대 512MB까지 저장할 수 있음 
  - 이외에도 셋(set) 해시(hash) 등을 지원함 
- pub/sub 기능을 통해 채팅 시스템, 다른 데이터베이스 앞단에 두어 사용하는 캐싱 계층, 
  - 단순한 키-값이 필요한 세션 정보관리, 정렬된 셋(sorted set) 자료 구조를 이용한 실시간 순위표 서비스에 사용함

---
## ✅ 기본 질문과 답변

---

### ✅ Q1. 관계형 데이터베이스(RDBMS)란 무엇인가요?

**답변:**
관계형 데이터베이스는 데이터를 **행(Row)과 열(Column)** 구조의 **테이블** 형태로 저장하며,
**SQL** 언어를 통해 데이터에 접근하고 조작하는 방식의 데이터베이스입니다.
MySQL, PostgreSQL, Oracle, SQL Server 등이 이에 해당합니다.

**특징:**

* 명확한 스키마(정형 데이터)
* 트랜잭션, JOIN 연산 등 복잡한 질의에 유리
* 정합성과 일관성에 강점

---

### ✅ Q2. MySQL과 PostgreSQL의 차이는 무엇인가요?

**답변:**

| 항목      | MySQL                    | PostgreSQL                    |
| ------- | ------------------------ | ----------------------------- |
| 사용성     | 설치 및 사용이 쉬움              | 다소 복잡하지만 기능이 풍부함              |
| 성능      | 읽기 성능에 강점                | 쓰기 성능, 복잡한 연산에 강점             |
| 기능      | 비교적 단순, MyISAM/InnoDB    | JSON 지원, 중첩 트랜잭션, 윈도우 함수 등 풍부 |
| 스토리지 엔진 | 선택 가능 (InnoDB, MyISAM 등) | 하나의 기본 엔진 사용 (WAL 기반)         |
| 용도      | 웹 서비스, 블로그, CMS 등        | 데이터 분석, 통계, GIS 등 복잡한 처리에 적합  |

---

### ✅ Q3. NoSQL이란 무엇이며, 언제 사용하는 것이 적절한가요?

**답변:**
NoSQL은 "Not Only SQL"의 줄임말로,
**스키마가 고정되지 않은 비정형 데이터**를 다루는 데 적합한 데이터베이스를 말합니다.
대표적으로 **MongoDB**(문서 기반), **Redis**(키-값 기반), **Cassandra**(컬럼 기반) 등이 있습니다.

**사용 적합 예시:**

* 실시간 채팅, 세션 캐시 등 빠른 응답이 필요한 경우 (→ Redis)
* 유동적인 구조의 로그 저장, 문서 저장 (→ MongoDB)
* 수평적 확장(Sharding)이 필요한 대규모 분산 환경

---

### ✅ Q4. MongoDB의 장점은 무엇인가요?

**답변:**

* **스키마가 유연**하여 다양한 형식의 데이터를 쉽게 저장 가능
* JSON 기반으로 가독성이 좋고, 직관적인 쿼리
* **레플리카셋, 샤딩** 등 분산 시스템에 강함
* ObjectID로 고유 ID를 자동 부여
* **대용량 데이터 로그, 이벤트 분석 시스템**에 적합

---

### ✅ Q5. Redis는 어떤 용도로 많이 사용되나요?

**답변:**
Redis는 인메모리 기반의 키-값 저장소로, 다음과 같은 용도에서 자주 사용됩니다:

* **캐시 서버**: DB 조회 결과를 Redis에 저장해 빠르게 응답
* **세션 저장소**: 사용자 로그인 세션 관리
* **Pub/Sub 시스템**: 채팅, 실시간 알림 등 이벤트 기반 메시징
* **실시간 랭킹 시스템**: Sorted Set 자료구조 활용

**장점:**

* 마이크로초(ms) 단위의 응답 속도
* TTL(만료 시간) 설정 가능
* 다양한 자료 구조(String, List, Set, Hash 등)

---

### ✅ Q6. RDBMS와 NoSQL은 언제 각각 사용하는 게 좋은가요?

**답변:**

| 상황                  | 적합한 DB                     | 이유                        |
| ------------------- | -------------------------- | ------------------------- |
| 정형 데이터 / 트랜잭션 필요    | RDBMS                      | 명확한 스키마, JOIN, 트랜잭션 지원    |
| 유연한 스키마 / 로그 저장     | MongoDB                    | 스키마 없는 문서 저장, 빠른 쓰기       |
| 빠른 응답 속도 / 실시간 서비스  | Redis                      | 메모리 기반, TTL 지원, 다양한 자료 구조 |
| 대용량 분산 처리 / 고가용성 필요 | NoSQL (Mongo, Cassandra 등) | 수평 확장성 및 복제 기능 우수         |

---

## ✅ 심화 질문과 답변


### ✅ Q1. RDBMS와 NoSQL의 가장 큰 설계 철학 차이는 무엇인가요?

**A.**
RDBMS는 **정형화된 스키마와 ACID 트랜잭션**을 기반으로 **정합성**과 **데이터 무결성**에 초점을 둔 반면,
NoSQL은 **유연한 스키마, 수평 확장성, 가용성**을 중시하는 구조입니다.

예를 들어, MySQL은 명확한 관계를 기반으로 JOIN과 정규화가 필수인 반면,
MongoDB는 JSON 형태로 데이터를 유연하게 저장하고 읽는 데 특화되어 있습니다.

---

### ✅ Q2. MySQL의 스토리지 엔진은 어떤 구조로 되어 있나요? InnoDB의 특징은?

**A.**
MySQL은 **모듈형 스토리지 엔진 구조**를 가지고 있어, 용도에 따라 다양한 엔진을 선택할 수 있습니다.
그중 대표적인 것이 **InnoDB**로, ACID를 보장하는 **트랜잭션 기능**과 **외래 키 지원**을 제공합니다.

* InnoDB는 WAL(Write Ahead Logging) 구조 기반으로 장애 복구가 가능하고,
* B-Tree 기반 인덱스를 활용하여 빠른 탐색이 가능합니다.

---

### ✅ Q3. MySQL에서 쿼리 캐시는 어떻게 동작하나요? 실무에선 왜 잘 안 쓰이나요?

**A.**
쿼리 캐시는 SQL 문장과 그 결과를 메모리에 저장하여 **동일한 쿼리가 들어올 경우 빠르게 응답**할 수 있게 합니다.
그러나 테이블의 데이터가 갱신되면 **해당 테이블과 관련된 모든 캐시가 무효화**되므로 실무에서는 **비효율적**입니다.

그래서 실무에서는 Redis 등 외부 캐시를 사용하는 경우가 더 많습니다.

---

### ✅ Q4. PostgreSQL에서 VACUUM이 필요한 이유는 무엇인가요?

**A.**
PostgreSQL은 MVCC(Multi-Version Concurrency Control)를 사용하여 데이터를 갱신할 때 **기존 레코드를 삭제하지 않고 새로운 버전을 생성**합니다.
이로 인해 **디스크 공간 낭비**가 발생하고 성능이 저하될 수 있기 때문에, **VACUUM 작업을 통해 불필요한 레코드를 제거**해야 합니다.

---

### ✅ Q5. MongoDB는 왜 정규화를 피하고 비정규화를 선호하나요?

**A.**
MongoDB는 문서 지향 DB로, 관련 정보를 **하나의 도큐먼트에 중첩 구조로 저장**하는 방식이 일반적입니다.
이는 JOIN이 비효율적이기 때문에 **읽기 성능을 우선시**하며,
**중복을 감수하고도 빠른 조회가 필요한** 서비스에 적합합니다.

예: 사용자 프로필 + 주소 정보 + 주문 이력 → 한 도큐먼트에 포함 가능

---

### ✅ Q6. Redis는 인메모리 DB인데, 데이터 손실 위험은 어떻게 대처하나요?

**A.**
Redis는 데이터 손실을 방지하기 위해 **2가지 내장 영속화 방식**을 제공합니다:

* **RDB(Snapshotting)**: 일정 주기마다 전체 상태를 저장
* **AOF(Append Only File)**: 모든 write 작업을 append log로 저장
  보통 **AOF + RDB 병행 설정**으로 실무에서 구성하며,
  AOF는 **flush policy**(매초/매명령 등)에 따라 신뢰성과 성능을 조절할 수 있습니다.

---

### ✅ Q7. Redis를 DB 앞단에 캐시 계층으로 둘 때 고려할 점은?

**A.**

1. **일관성 문제**: 캐시와 DB가 서로 다른 데이터를 가지는 **캐시 일관성 문제** 발생 가능
   → write-through / write-behind / cache-aside 패턴 활용
2. **캐시 무효화 정책**: TTL 설정, LRU 정책 등으로 스토리지 용량 제어
3. **Failover 구성**: Redis Sentinel, Redis Cluster 등을 통한 고가용성 확보

---

### ✅ Q8. MongoDB의 ObjectID 구조는 어떻게 되며, 어떤 장점이 있나요?

**A.**
MongoDB의 ObjectID는 12바이트로 구성되며 다음과 같은 구조를 가집니다:

| 구성 요소     | 크기 | 설명                |
| --------- | -- | ----------------- |
| Timestamp | 4B | 생성 시점의 Unix 시간    |
| 머신 ID     | 5B | 서버의 고유 식별자        |
| 카운터       | 3B | 같은 시간에 생성된 ID 구분용 |

→ 시간 순 정렬이 가능하고, **분산 환경에서도 충돌 없이 유일성** 보장됨.

---

### ✅ Q9. Redis의 pub/sub 기능은 어떤 구조이고, 어디에 활용하나요?

**A.**
Redis는 pub/sub 구조를 통해 **발행자-구독자 모델**을 구현할 수 있습니다.

* 메시지를 **채널** 단위로 publish하고,
* 구독자는 해당 채널의 메시지를 실시간으로 수신합니다.

**활용 예시:**

* 실시간 채팅 시스템
* 알림 전송 시스템
* 서버 간 메시지 브로드캐스팅

> 단점: pub/sub 메시지는 **저장되지 않고 휘발성**이므로, 구독자가 없으면 메시지 손실됩니다.

