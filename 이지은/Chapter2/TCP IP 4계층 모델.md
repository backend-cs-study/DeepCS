# Chapter2-2. TCP/IP 4계층 모델

## 1) TCP/IP 4계층 구조 
<img src="https://flaxen-swan-41e.notion.site/image/attachment%3A5aaacf13-d50f-44d6-b935-0e939f66d028%3Aimage.png?table=block&id=1feb649e-bbbd-80fb-a587-ecd13d7ad81c&spaceId=765aecbd-0d96-4102-a877-7bb784aaedf1&width=1200&userId=&cache=v2">

#### 각 계층 대표 스택
  * **4계층 - 애플리케이션 계층**: FTP, HTTP, SSH, SMTP, DNS
  * **3계층 - 전송 계층**: TCP, UDP, QUIC
  * **2계층 - 인터넷 계층**: IP, ARP, ICMP
  * **1계층 - 링크 계층**: 이더넷

<br>

### 4️⃣ 애플리케이션 계층
응용 프로그램이 사용되는 프로토콜 계층. 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 층

> ### 📢 애플리케이션 계층 대표 스택
> 1) FTP (File Transfer Protocol): 장치와 장치 간의 파일을 전송하는데 사용되는 표준 통신 프로토콜
> 2) SSH (Secure Shell): 보안되지 않은 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜
> 3) HTTP (HyperText Transfer Protocol): WWW을 위한 데이터 통신. 웹 사이트를 이용하는데 쓰는 프로토콜
> 4) SMTP (Simple Mail Transfer Protocol): 전자 메일 전송을 위한 인터넷 표준 통신 프로토콜
> 5) DNS (Domain Name System): 도메인 이름과 IP 주소를 매핑해주는 서버. IP주소가 바뀌어도 사용자들에게 똑같은 도메인 주소로 서비스 가능

<br>

### 3️⃣ 전송 계층
송신자와 수신자를 연결하는 통신 서비스 제공. 연결 지향 데이터 스트림 지원. 신뢰성, 흐름 제어 등 제공 <br>
ex) TCP, UDP

#### ❶ TCP (Transmission Control Protocol)
* 신뢰성 있는 데이터 전송을 보장하는 연결 지향형 프로토콜
* 데이터가 순서대로 도착하도록 하고, 패킷 손실 시 재전송을 수행
* 예: 웹 브라우징(HTTP/HTTPS), 이메일(SMTP), 파일 전송(FTP) 등

    #### 🔌 가상회선 교환 방식 (Virtual Circuit Switching)
    * 통신을 시작하기 전에 논리적인 가상 회선을 미리 설정한 후 데이터 전송
    * 각 패킷에 가상회선 식별자가 포함됨
    * 모든 패킷은 동일한 경로(가상회선)을 통해 전송
    * 패킷은 순서대로 도착
    * 통신이 끝나면 가상회선은 해제됨

    #### ✅ 회선 연결: 3-웨이 핸드셰이크 (3-Way Handshake)
    * 클라이언트와 서버 간의 신뢰성 있는 연결(세션)을 수립하기 위한 과정
    * 동작 과정
      1) [SYN] 클라이언트 → 서버 요청: 클라이언트가 서버에 초기 순서 번호(ISN)를 포함한 연결 요청 전송
      2) [SYN + ACK] 서버 → 클라이언트 응답: 서버가 클라이언트의 SYN 요청을 서버의 ISN와 클라이언트의 ISN + 1로 수신
      3) [ACK] 클라이언트 → 서버 최종 확인: 클라이언트가 서버의 SYN + ACK에 대해 ACK(확인 응답) 전송
    #### ❎ 회선 해제: 4-웨이 핸드셰이크 (4-Way Handshake)
    * 클라이언트와 서버가 서로의 연결 종료 의사를 확인하고 안전하게 연결을 해제하기 위한 과정
    * 동작 과정
      1) [FIN] 클라이언트 → 서버 종료 요청: 클라이언트가 서버에 더 이상 보낼 데이터가 없음을 알리고 연결 종료를 요청(FIN). 클라이언트는 `FIN_WAIT_1`상태가 됨.
      2) [ACK] 서버 → 클라이언트 수신 확인: 서버는 클라이언트의 종료 요청을 수신했음을 확인하고 ACK를 전송하고 `CLOSE_WAIT`상태가 됨. 클라이언트는 연결 종료 대기 상태 `FIN_WAIT_2`상태가 됨
      3) [FIN] 서버 → 클라이언트 종료 요청: 서버는 일정 시간 후 클라이언트에게 FIN 전송
      4) [ACK] 클라이언트 → 서버 수신 확인: 클라이언트는 `TIME_WAIT`가 되고 다시 서버로 ACK를 보내 `CLOSED`상태가 됨

> #### 💬 왜 일정시간 뒤에 연결을 해제할까?
> 1) 지연패킷에 대비하여 데이터 무결성 문제 예방
> 2) 두 장치가 연결이 닫혔는지 확인하기 위함

<br>

#### ❷ UDP (User Datagram Protocol)
* 빠른 전송을 우선시하는 비연결형 프로토콜
* 신뢰성은 낮지만 속도가 빠름.
* 순서 보장이나 재전송을 하지 않기 때문에 실시간 성능이 중요한 서비스에 적합 
* 예: 동영상 스트리밍, 온라인 게임, VoIP(음성 통화) 등

    #### 🔌 데이터 그램 교환 방식
    * 각 패킷이 독립적으로 이동하며 최적의 경로를 선택
    * 하나의 메시지에서 분할된 패킷은 서로 다른 경로를 선택하여 도착순서가 다를 수 있음

<br>

#### ✅ TCP vs UDP 비교
| 항목            | TCP (Transmission Control Protocol)          | UDP (User Datagram Protocol)    |
|---------------|----------------------------------------------|---------------------------------|
| **연결 방식**     | 연결 지향형 (3-Way Handshake로 연결 수립)              | 비연결형 (연결 없이 데이터 전송)             |
| **신뢰성**       | 신뢰성 높음 (패킷 손실 시 재전송, 순서 보장)                  | 신뢰성 낮음 (손실/순서 보장 없음)            |
| **속도**        | 느림 (정확성 우선)                                  | 빠름 (속도 우선)                      |
| **데이터 전송 방식** | 가상회선 교환 방식 (순서대로 도착, 동일 경로 사용)               | 데이터그램 교환 방식 (서로 다른 경로, 순서 보장 X) |
| **오버헤드**      | 큼 (헤더, 재전송, 흐름 제어 등 포함)                      | 작음 (간단한 헤더 구조)                  |
| **주요 사용 예시**  | 웹 브라우징 (HTTP/HTTPS), 이메일(SMTP), 파일 전송(FTP) 등 | 스트리밍, 온라인 게임, VoIP, 실시간 통신 등    |
| **연결 종료**     | 4-Way Handshake로 명시적 연결 해제                   | 연결 자체가 없으므로 종료 절차 없음            |
| **순서 보장**     | 순서대로 도착 보장                                   | 순서 보장 없음                        |
| **에러 처리**     | 오류 감지 및 재전송                                  | 최소한의 오류 감지만 수행                  |


<br>

### 2️⃣ 인터넷 계층
인터넷을 장치로 부터 받은 네트워크 패킷을 IP주소로 지정된 목적지까지 전송하기 위해 사용되는 계층 <br>
패킷을 수신해야 할 상대의 주소를 지정하여 데이터 전달. 수신확인 불가 <br>
ex) IP, ARD, ICMP 등

<br>

### 1️⃣ 링크 계층 (= 네트워크 접근 계층)
실질적으로 데이터를 전달. 장시간 신호를 주고받는 규칙을 정하는 계층 <br>
* 데이터 링크 계층: 이더넷 프레임을 통해 에러 확인, 흐름제어, 접근 제어
* 물리 계층: 무선 LAN과 유선 LAN을 통해 0과 1로 이루어진 데이터 통신을 보내는 계층

#### ❶ 유선 LAN
* 유선 LAN은 이더넷(Ethernet)을 기반으로 하는 근거리 통신망. **IEEE 802.3** 표준

    #### 🔁 전이중 통신 (Full Duplex Communication)
    * 양쪽 장치가 동시에 데이터를 송신하고 수신할 수 있는 통신 방식. 송신용과 수신용 회선 2개가 필요.
    * 충돌이 발생하지 않기 때문에 **CSMA/CD가 불필요**

    #### ⚠️ CSMA/CD (Carrier Sense Multiple Access with Collision Detection)
    * 과거에는 유선 LAN에 반이중화 통신 중 하나인 CSMA/CD 사용
    * 반이중(Half Duplex) 환경에서 사용하는 충돌 감지 방식
    * 현재는 대부분 스위치 기반의 전이중 방식을 사용하기 때문에 CSMA/CD는 거의 사용되지 않음
  
    #### 🔌 사용 케이블
    1) 트위스트 페어 케이블
        * UTP 케이블: 구리선에 실드 처리를 하지 않음
        * STP 케이블: 구리선에 실드 처리함
    2) 광섬유 케이블
        * 레이저를 이용해서 장거리 및 고속 통신 가능 (100Gbps)
        * 광섬유 내부와 외부를 다른 밀도를 가지는 유리 및 플라스틱 섬유로 제작

<br>

#### ❷ 무선 LAN
* 전파(무선 주파수)를 사용하여 장치 간 데이터를 송수신하는 근거리 통신망. **IEEE 802.11** 표준
    
    #### 🔁 반이중 통신 (Half Duplex Communication)
    * 무선 LAN은 수신과 송신에 동일한 채널을 사용하므로 동시에 송수신이 불가능한 반이중 통신 방식
    * 전송 중에는 수신, 수신 중 전송 불가

    #### ⚠️ CSMA/CA (Carrier Sense Multiple Access with Collision Avoidance)
    * 충돌 감지 대신 충돌 회피 사용
    * 송신 전 채널이 비어있는 지 확인하고 무작위 대기 시간을 설정한 후 전송

    #### 📡 연결 주파수 대역
    * 2.4GHz: 장애물에 강하고 넓은 범위 커버. 간섭에 취약
    * 5GHz: 채널 수가 많아 속도가 빠르고 간섭이 적음. 도달 범위는 짧고 장애물에 약함

    #### 사용 예시
    1. **Wi-Fi**: 가장 일반적인 무선 LAN 방식 (IEEE 802.11)
    2. **ZigBee**: 저전력, 저속 통신에 적합한 근거리 무선 통신 (IoT에서 많이 사용)
    3. **Bluetooth**: 근거리 장치 간 무선 통신 (헤드폰, 키보드 등)

> ### 📢 BSS 와 ESS
> 1) BSS (Basic Service Set): 기본 서비스 집합. 단순 공유기를 통해 네트워크에 접속하는 것이 아닌 동일 BSS 내 AP장치들과 통신하는 구조
>    * 근거리 무선 통신 제공
>    * 하나의 AP 기반 구축하여 사용자가 이동하며 사용하는 것이 불가
> 2) ESS (Extended Service Set): 하나 이상의 연결된 BSS 그룹.
>    * 장거리 무선 통신 제공
>    * 가용성과 이동성을 지원하여 이동할 때 중단 없이 네트워크 연결 가능

<br>

#### ✅ 유선 LAN vs 무선 LAN
| 항목       | 유선 LAN                  | 무선 LAN                |
|----------|-------------------------|-----------------------|
| 표준       | IEEE 802.3 (Ethernet)   | IEEE 802.11 (Wi-Fi 등) |
| 통신 방식    | 전이중 (Full Duplex)       | 반이중 (Half Duplex)     |
| 충돌 제어 방식 | CSMA/CD (현재는 거의 사용 안 함) | CSMA/CA               |
| 물리 매체    | UTP, STP, 광섬유 케이블       | 무선 전파 (2.4GHz, 5GHz)  |
| 설치 용이성   | 설치 복잡, 안정성 높음           | 설치 용이, 환경에 민감         |
| 사용 예시    | 데스크탑, 서버, 산업용 네트워크      | 스마트폰, 노트북, IoT 기기     |

<br>

> ### ⏏️ 이더넷 프레임
> <img src="https://flaxen-swan-41e.notion.site/image/attachment%3Aa76ca26b-ba80-42d7-b5a0-b0fa1ebaca61%3Aimage.png?table=block&id=1feb649e-bbbd-805e-ada4-e93a466e9dbb&spaceId=765aecbd-0d96-4102-a877-7bb784aaedf1&width=980&userId=&cache=v2">
> 
> * Preamble: 이더넷 프레임 시작
> * SFD: 다음 바이트 부터 MAC 주소 필드 시작
> * DMAC, SMAC: 수신 및 송신 MAC주소
> * Ether Type: 데이터 계층 위의 계층인 IP 프로토콜 정의 (IPv4 / IPv6)
> * Payload: 전달받은 데이터
> * CRC: 에러 확인 비트

> ### 📢 MAC 주소
> 컴퓨터나 노트북 등 각 장치에는 네트워크에 연결하기 위한 장치가 있는데, 이를 구별하기 위한 식별번호

<br>

> ## 📢 계층 간 데이터 송수신
> * 캡슐화 과정: 상위 계층의 헤더와 데이터를 하위 계층의 데이터에 포함시키고 해당 계층의 헤더를 삽입
>   * 애플리케이션 계층 ---**TCP 헤더 (세그먼트 및 데이터 그램화)**-->  전송 계층 ---IP 헤더 (패킷화)--> 인터넷 계층 ---프레임 헤더, 트레일러(프레임화)--> 링크 계층
> * 비캡슐화 과정: 하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하는 과정
>   * 이후 최종적으로 사용자에게 애플리케이션의 PDU인 메시지로 전달

<br>

## 2) PDU (Protocol Data Unit)
* 제어 관련 정보들이 포함된 헤더 + 페이로드로 구성
  * 애플리케이션 계층: 메시지
  * 전송 계층: 세그먼트(TCP), 데이터그램(UDP)
  * 인터넷 계층: 패킷
  * 링크 계층: 프레임(데이터 링크 계층), 비트(물리 계층)