# 2.2 TCP/IP 4계층 모델

## 개요

인터넷 프로토콜 스위트(Internet Protocol Suite)는 인터넷에서 컴퓨터들이 서로 정보를 주고받기 위해 사용하는 프로토콜 집합이며, TCP/IP 4계층 모델이나 OSI 7계층 모델로 설명됩니다.

TCP/IP 모델은 프로토콜의 네트워킹 범위에 따라 4개의 계층으로 구성됩니다.

---

## 2.2.1 계층 구조

### TCP/IP 4계층과 OSI 7계층 비교

| TCP/IP 4계층         | OSI 7계층                                |
|----------------------|------------------------------------------|
| Application          | Application, Presentation, Session       |
| Transport            | Transport                                |
| Internet             | Network                                  |
| Link (Network Access)| Data Link, Physical                      |

- OSI는 애플리케이션 계층을 세분화하고, 링크 계층을 물리/데이터링크로 나눕니다.
- 각 계층은 변경 시 다른 계층에 영향을 주지 않도록 설계되어 있습니다.

---

## 애플리케이션 계층

응용 프로그램이 사용하는 프로토콜 계층으로 사용자에게 직접 서비스를 제공합니다.

### 주요 프로토콜

- **FTP**: 장치 간 파일 전송
- **SSH**: 보안 원격 접속
- **HTTP**: 웹 통신용 프로토콜
- **SMTP**: 이메일 전송용 프로토콜
- **DNS**: 도메인 이름과 IP 주소를 매핑

---

## 전송 계층 (Transport Layer)

송신자와 수신자 간의 통신을 중계하며, 신뢰성, 흐름 제어, 오류 제어 등의 기능을 담당합니다.

### TCP (Transmission Control Protocol)

- 연결 지향형
- 순서 보장, 신뢰성 보장
- 수신 여부 확인
- 가상회선 방식 사용

#### 가상회선 방식
- 패킷마다 식별자를 부여해 순서를 유지하고, 전송이 끝나면 회선 해제

#### TCP 3-Way Handshake

1. 클라이언트 → 서버: SYN
2. 서버 → 클라이언트: SYN + ACK
3. 클라이언트 → 서버: ACK

#### TCP 연결 해제 (4-Way Handshake)

1. 클라이언트 → 서버: FIN (FIN_WAIT_1 상태)
2. 서버 → 클라이언트: ACK (CLOSE_WAIT, 클라이언트는 FIN_WAIT_2)
3. 서버 → 클라이언트: FIN
4. 클라이언트 → 서버: ACK (TIME_WAIT 상태 후 CLOSED)

**TIME_WAIT 상태의 이유:**

- 지연된 패킷의 처리 보장
- 연결 종료 확인 보장

---

### UDP (User Datagram Protocol)

- 비연결형
- 순서 보장 없음, 수신 확인 없음
- 빠르고 단순한 통신
- 데이터그램 방식 사용

#### 데이터그램 방식

- 패킷이 독립적으로 전송되며 경로가 다를 수 있고, 순서를 보장하지 않음

---

## 인터넷 계층

IP 주소를 기반으로 패킷을 목적지로 전달하며, 네트워크 간 라우팅 역할을 수행합니다. 비연결형입니다.

### 주요 프로토콜

- **IP**: 인터넷 주소 지정
- **ARP**: IP ↔ MAC 주소 변환
- **ICMP**: 네트워크 진단 (ping 등)

---

## 링크 계층

전기적 신호나 무선 전파를 이용해 물리적인 데이터 전송을 담당하는 계층입니다. 물리 계층 + 데이터 링크 계층의 역할을 포함합니다.

---

### 유선 LAN (IEEE 802.3)

- **전이중화 통신 (Full Duplex)**
  - 송신로/수신로를 분리하여 동시 송수신 가능

- **CSMA/CD 방식**
  - 충돌 발생 시 일정 시간 대기 후 재전송

#### 케이블 종류

- **트위스트 페어 케이블 (Twisted Pair Cable)**
  - 구리선 8개를 2개씩 꼬아서 구성
  - UTP (비차폐), STP (차폐)
  - RJ-45 커넥터 사용

- **광섬유 케이블 (Optical Fiber)**
  - 레이저를 통해 고속/장거리 통신 가능
  - 내부에서 반사를 반복하여 빛을 전달
  - Core(굴절률 높음), Cladding(굴절률 낮음)

---

### 무선 LAN (IEEE 802.11)

- **반이중화 통신 (Half Duplex)**
  - 한 번에 한 방향만 송수신 가능

- **CSMA/CA 방식 (충돌 회피)**

#### CSMA/CA 동작 과정

1. 전송 전 무선 매체를 확인
2. 비어 있으면 대기 시간(IFS) 후 전송
3. 충돌 가능성을 줄이기 위해 무작위 대기 적용

#### 무선 주파수

- **2.4GHz 대역**: 장애물에 강하지만 간섭 많음
- **5GHz 대역**: 빠르고 간섭 적음

#### Wi-Fi

- 무선 공유기(AP)를 통해 무선 신호를 생성
- 주변 장치들이 AP에 접속하여 인터넷 사용 가능

#### BSS (Basic Service Set)

- 하나의 AP를 기반으로 구성
- 이동성이 제한적

#### ESS (Extended Service Set)

- 여러 BSS가 연결된 구조
- 이동 중에도 끊김 없는 통신 가능

---

## 이더넷 프레임 구조

데이터 링크 계층에서 사용하는 프레임 구조입니다.

| 필드        | 설명 |
|-------------|------|
| Preamble    | 프레임 시작 알림 |
| SFD         | MAC 주소 시작 알림 |
| DMAC        | 목적지 MAC 주소 |
| SMAC        | 출발지 MAC 주소 |
| EtherType   | 상위 계층 프로토콜 (IPv4/IPv6) |
| Payload     | 실제 데이터 |
| CRC         | 오류 검출 비트 |

---

## 계층 간 데이터 송수신 과정

- **캡슐화**: 상위 계층의 데이터를 하위 계층으로 전달하며 헤더를 붙이는 과정
- **비캡슐화**: 수신 측에서 각 계층의 헤더를 제거하며 상위 계층으로 전달하는 과정

### 캡슐화 순서

1. 애플리케이션 계층: 메시지
2. 전송 계층: TCP/UDP 헤더 추가 → 세그먼트/데이터그램
3. 인터넷 계층: IP 헤더 추가 → 패킷
4. 링크 계층: 프레임 헤더/트레일러 추가 → 프레임

### 비캡슐화 순서

- 링크 계층에서 수신 → 헤더 제거 → IP 패킷 전달 → 전송 계층 전달 → 최종적으로 애플리케이션 계층에 도달

---

## 2.2.2 PDU (Protocol Data Unit)

각 계층에서 데이터를 주고받을 때 사용하는 논리적 단위입니다.

| 계층             | PDU 명칭                             |
|------------------|--------------------------------------|
| 애플리케이션 계층 | 메시지                               |
| 전송 계층         | 세그먼트 (TCP), 데이터그램 (UDP)     |
| 인터넷 계층       | 패킷 (Packet)                        |
| 링크 계층         | 프레임 (Frame), 비트 (Bit)           |

- 모든 PDU는 **헤더 + 페이로드** 구조로 이루어져 있습니다.
